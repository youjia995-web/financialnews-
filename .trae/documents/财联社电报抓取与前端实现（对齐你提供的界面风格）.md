## 项目目标与范围
- 目标：从财联社“电报”页实时拉取新闻，做本地存储、去重与筛选，并以你提供的卡片式界面展示。
- 当前范围：仅接入财联社电报源；保留扩展位以便后续接入同花顺、界面、东方财富等。

## 技术栈
- 后端：Node.js + TypeScript，轻量服务（NestJS 或 Express），Axios 作为 HTTP 客户端。
- 前端：Next.js（SSR/ISR 提升首屏与抓取稳定性）+ Tailwind CSS，组件化实现卡片与过滤条。
- 存储：SQLite（开发期便携）→ 可平滑迁移到 Postgres。
- 任务调度：node-cron（每 10–30 秒探测增量），支持手动“刷新”。

## 数据源与抓取策略
- 主数据源：财联社 Web 节点接口
  - 列表接口：`https://www.cls.cn/nodeapi/telegraphList`
  - 典型参数：`app=CailianpressWeb&os=web&refresh_type=1&order=1&rn=50&sv=8.x.x&sign=<值>`
  - 返回结构：`data.roll_data[]`，字段含 `ctime`（时间）、`title`、`brief`、`content`、`shareurl` 等。
- 备选/容灾：
  - 页面解析（必要时从 `https://www.cls.cn/telegraph` 提取 DOM）。
  - 若接口受限：支持切换 RSSHub 的电报源作为只读备选。
- 采集策略：
  - 设置浏览器型 UA、超时与重试，指数退避；
  - 只拉增量（按最新时间与 ID 去重）；
  - 速率限制与随机抖动，避免频繁触发风控；
  - 归档原文链接与摘要，明确来源归属与跳转。

## 数据模型与存储
- news(id, source, title, brief, content, url, published_at, raw, hash, created_at)
- 索引：`source+published_at`、`hash`；去重依据：`hash(title+brief+published_at)` 或远端 ID。
- 原始字段 `raw` 以 JSON 存储，便于回溯。

## 后端 API 设计
- GET `/api/news`：分页、关键词、时间段、来源、情绪筛选（见下）。
- GET `/api/news/:id`：详情。
- GET `/api/health`：抓取器与数据库状态。
- 管理端：POST `/api/refresh`（手动触发一次抓取）。

## 情绪/标签规则（对齐界面“利好/利空”）
- 规则版：关键词与模式打分（如“涨停、增持、超预期”→利好；“停牌、处罚、亏损、爆雷”→利空）。
- 得分落点映射到界面右上角的“利好/利空 ±N”。
- 预留接口：可替换为模型服务（后期支持更智能的“AI 评注”）。

## 前端界面设计（对齐你的图片）
- 顶部导航条：品牌名、来源切换、情绪过滤（全部/利好/利空）、“监测中 x s”状态与“刷新”按钮。
- 过滤标签：来源（财联社）、主题分组（预留：见闻/问询/新股等）、“全部/利好/利空”。
- 卡片：
  - 左上角时间戳（如 2025-12-19 16:18:00）；右上角情绪徽标（利好/利空 ±N）；
  - 标题 + 摘要/正文片段；
  - “AI 评注”模块（可折叠，初期用规则引擎生成 1–2 行点评）；
  - 底部操作：查看原文、标记已读；显示来源徽标（财联社）。
- 列表：虚拟滚动或无限加载；已读置灰；新消息高亮动画。
- 主题色：深色导航、浅色卡片；与示例截图一致的间距与排版层级。

## 采集器实现要点
- 统一 FetchService：封装 UA/重试/速率限制；
- Parser：优先 JSON；必要时 DOM 解析（Cheerio）；
- Deduper：哈希与时间窗；
- Scheduler：定时拉取 + 手动刷新；
- Observer：将增量推送到前端（SSE 或 WebSocket，Next.js 先用轮询/ISR）。

## 验证与监控
- 单元测试：解析器、去重器、情绪规则；
- 集成测试：调用真实接口的冒烟用例（带跳过标记与速率限制）；
- 指标：抓取成功率、条目增量/分钟、接口错误率；
- 日志：结构化（source、count、latency、next_cursor）。

## 风险与合规
- 尊重网站使用条款与版权，页面内明确来源与原文跳转；
- 抓取频率温和，缓存与本地展示为主，不进行大规模转载；
- 使用配置开关一键停用数据源；故障时回退到备选源。

## 里程碑（实施顺序）
1) 建基础项目骨架（Next.js + API + SQLite）。
2) 接财联社接口，打通首屏数据并完成去重。
3) 完成卡片与过滤 UI、情绪徽标与“AI 评注”。
4) 加调度与监控，完善错误与容灾；
5) 打包可运行 Demo，准备扩源接入。