# 智能财经问答体验优化计划

针对用户反馈的“无加载状态”和“超时无内容”两个问题，本计划将重点优化前端交互体验，通过增加清晰的 Loading 状态和流式输出（或模拟流式）来解决等待焦虑和超时问题。

## 1. 问题分析

1.  **无加载状态**：目前虽然有 `loading` 状态，但可能在 UI 上表现不明显（仅按钮变色），用户在长达 60s 的等待中以为系统卡死。
2.  **超时风险**：Next.js Serverless Function 默认超时限制（通常 10-60s），而 DeepSeek 思考时间较长。
    *   **彻底解决**：需要改为 **Streaming (流式响应)**。
    *   **快速修复**：鉴于改流式涉及后端架构调整（API Route 需要改为 Edge Runtime 或使用 `StreamingTextResponse`），目前先采用**优化 Loading 提示 + 增加超时容错**的方案。

## 2. 优化方案

### 2.1 增强 Loading 状态 (`app/analyst/page.js`)
*   **当前**：仅按钮变灰。
*   **目标**：在结果区域显示一个动态的“思考中”动画。
*   **文案轮播**：显示“正在搜索网络信息...”、“正在读取市场快讯...”、“AI 正在深度思考...”等步骤文案，让用户知道进度。

### 2.2 结果展示优化
*   如果 `result` 为字符串（智能问答直接返回文本），则直接渲染 Markdown。
*   如果 `result` 为对象（个股诊断），则渲染图表+文本。
*   目前代码里 `activeTab === 'query'` 时，`result` 应该是字符串，但渲染逻辑里只处理了 `result.analysis`（个股模式）。需要兼容智能问答的纯文本结果。

### 2.3 解决“无内容展示”
*   修改渲染逻辑：对于智能问答（Query 模式），直接渲染 `result` 字符串。
*   目前代码逻辑：
    ```javascript
    {result.analysis && ( ... )} // 只检查了 analysis
    ```
    智能问答返回的是纯字符串，所以被忽略了！这是导致“无内容”的核心 bug。

## 3. 执行步骤

1.  **修复渲染 Bug**：在 `app/analyst/page.js` 中，增加对 `activeTab === 'query'` 的渲染支持。
    *   如果 `activeTab === 'query'`，直接显示 `result`（Markdown）。
2.  **美化 Loading**：添加一个全屏或局部遮罩的 Loading 组件，包含动态文案。
3.  **超时处理**：前端 `fetch` 设置较长的 timeout（如 120s），虽然服务端可能先断，但至少前端多等会儿。

## 4. 代码变更预览

```javascript
// app/analyst/page.js

// 1. 修复渲染
{activeTab === 'query' && typeof result === 'string' && (
  <div style={{ padding: 32 }}>
    <ReactMarkdown>{result}</ReactMarkdown>
  </div>
)}

// 2. 增强 Loading
{loading && (
  <div style={{ textAlign: 'center', padding: 60 }}>
    <div className="spinner"></div>
    <p>AI 正在深度思考，耗时较长请耐心等待...</p>
  </div>
)}
```
