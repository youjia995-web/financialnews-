# 个股分析结果页优化计划

本计划旨在优化个股分析结果的展示，增加结构化数据和图表，提升用户体验。

## 1. 核心变更点

### 1.1 后端数据结构调整 (`src/ai/analyst.js`)
*   **当前**: 直接返回 Markdown 文本 (`result`).
*   **目标**: 返回结构化对象 `{ meta, klineData, indicators, analysis }`。
    *   `meta`: 股票代码、名称（需 Tushare 支持或自行映射）、最新价格、涨跌幅。
    *   `klineData`: 最近 120 天的 `{ date, close, ma5 }` 数组，用于前端画图。
    *   `indicators`: 关键指标对象（RSI, MACD, MA 等）。
    *   `analysis`: AI 生成的 Markdown 报告。

### 1.2 前端展示优化 (`app/analyst/page.js`)
*   **新增**: 股票基本信息卡片（顶部）。
*   **新增**: 简单的 K 线/均线走势图。
    *   由于不想引入沉重的图表库（如 ECharts），可以使用轻量级的 SVG 绘制，或者使用 `recharts`（如果项目允许新增依赖）。鉴于项目简洁性，建议使用 **Recharts**，它对 React 友好且体积适中。
*   **调整**: 将 Markdown 报告放在图表下方。

## 2. 实施步骤

### 2.1 后端改造
1.  修改 `src/ai/analyst.js` 中的 `analyzeStock` 函数。
2.  在返回给前端的数据中，除了 AI 的文本，额外透传：
    *   `latest` 对象（包含最新收盘价、日期等）。
    *   `history` 数组的精简版（用于画图，包含 date, close, ma5）。
    *   **注意**: Tushare 免费接口可能不返回股票名称，如果需要名称，可能需要额外的映射表或再次调用 Tushare 的 `stock_basic` 接口（如果 token 权限够）。这里暂时先用代码代替，或者尝试从 Tushare 返回的数据中寻找（通常日线不带名称）。

### 2.2 前端改造
1.  安装 `recharts` 库：`npm install recharts`。
2.  修改 `app/analyst/page.js`。
    *   解析后端返回的结构化数据。
    *   渲染 **股票信息头**：代码、最新价、涨跌幅（颜色区分）。
    *   渲染 **走势图**：使用 `recharts` 绘制 `AreaChart` (收盘价) + `LineChart` (MA5)。
    *   渲染 **AI 报告**：保持 Markdown 展示。

## 3. 依赖变更
*   需要安装 `recharts`。

## 4. Tushare 补充
*   为了获取股票名称，可以在 `fetchHistory` 时顺便尝试获取（如果 Tushare 支持）。或者在前端展示时仅显示代码。目前 Tushare `daily` 接口不返回名称。
*   *方案*: 可以在 Tushare Fetcher 中增加一个简单的内存缓存，存储 `code -> name` 的映射（调用 `stock_basic` 接口一次性获取）。但考虑到复杂性，第一版优化先只显示代码和价格。

## 5. 执行计划
1.  安装 `recharts`。
2.  修改后端 `src/ai/analyst.js` 返回结构化数据。
3.  修改前端 `app/analyst/page.js` 实现图表和新布局。
